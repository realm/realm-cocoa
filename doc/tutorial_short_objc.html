<!--?xml version="1.0" encoding="iso-8859-1"?-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
  <title>TightDB Objective-C Interface Tutorial</title>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <link rel="stylesheet" href="style.css" type="text/css" media="screen">

<link href="prettify.css" type="text/css" rel="stylesheet">
<script src="tutorial_short_cpp_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript" src="prettify.js"></script>


<script type="text/javascript">

  var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-23135871-1']);
      _gaq.push(['_setDomainName', '.tightdb.com']);
        _gaq.push(['_trackPageview']);

  (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
              var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();

</script>

<style type="text/css">

.main {
color: #0067AB;
font-family: 'Open Sans','Helvetica Neue',Helvetica;
}

h1, h2, h3, h4, h5 {
color: #0067AB;
font-family: 'Open Sans','Helvetica Neue',Helvetica;
}

.p_docs h1 h2 {
margin-bottom: 25px;
-moz-border-radius: 3px;
-webkit-border-radius: 3px;
-o-border-radius: 3px;
-ms-border-radius: 3px;
-khtml-border-radius: 3px;
border-radius: 3px;
margin-top: 35px;
border-bottom: 1px solid #CBE3F3;
background: #E0EEF8;
padding: 10px;
color: #0067AB;
font-size: 22px;
}

.code {
background: #E0EEF8;
border: 1px solid #B6D7EF;
padding: 15px;
font-size: 13px;
line-height: 19px;
font-family: "Monaco","Courier New",Courier;
margin-bottom: 25px;
}

.header {
background: #E0EEF8;
border: 1px solid #E0EEF8;
padding: 5px;
font-size: 13px;
line-height: 3px;
font-family: "Monaco","Courier New",Courier;
margin-bottom: 25px;
color: #0067AB;
}

    .prettyprint
    {
        margin-left: 0px;
    }

</style>


</head>
<body onload="prettyPrint()" style="margin-top: 0px;">

<div>
<a href="index.html"><img src="logo200.png"></a>
</div>

<div class="main" style="width: 800px; margin: 0px auto -1px;">

<!--
 background: none repeat scroll 0% 0% rgb(240, 240, 240); padding: 10px;">
-->

<h1>TightDB Objective-C Interface</h1>

<p>
This introduction to TightDB will introduce you very briefly to commonly used 
features of TightDB. Please refer to the full reference manual for further 
details.
</p>
<p>
TightDB is a very fast embedded database that integrates transparently 
into your
language and gives you the full benefits of a database, but with a much 
lower memory footprint and better performance than native data 
structures. It is also much more flexible and has a friendly and easy to
 use interface.
</p>
<p>
TightDB data structures are represented by tables with typed and untyped columns. 
A column in a table can be any of the following column types:
</p>
<ul>
<li>Integers</li>
<li>Booleans</li>
<li>Strings</li>
<li>Dates </li>
    <li>Binary </li>
    <li>Tables</li>
<li>Mixed (any of the above, i.e. untyped)</li>
</ul> 
<p>
More datatypes will be added in the near future. Check our
website <a href="http://www.tightdb.com/">www.tightdb.com</a> for updates.
</p>
<h2>Creating tables</h2>
<p>
First let's create a table named &#8216;PeopleTable&#8217; with 3 columns:
</p>

<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">// Define table
TDB_TABLE_3(PeopleTable,
    String, Name,
    Int,    Age,
    Bool,   Hired)

// Use it in a function
- (void)func {
    PeopleTable *people = [[PeopleTable alloc] init];
    ...
}
</pre>
</div>
<p>
The above code instantiates a TightDB table with 3 typed columns called:
&#8216;<tt>Name</tt>&#8217;, &#8216;<tt>Age</tt>&#8217; and &#8216;<tt>Hired</tt>&#8217;. Column names must start with capital letter.
</p>
<p>
    We add rows to the end of the table with the <tt>
    Add()</tt> method:</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">[people addName:@"John&quot; Age:20 Hired:YES];
[people addName:@"Mary&quot; Age:21 Hired:NO];
[people addName:@"Lars&quot; Age:21 Hired:YES];
[people addName:@"Phil&quot; Age:43 Hired:NO];
[people addName:@"Anni&quot; Age:54 Hired:YES];
</pre>
</div>
<p>
    We now have 5 rows in our table.
<p>
You can also insert rows at specific positions:
</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">[people insertAtIndex:2 Name:@"Frank&quot; Age:34 Hired:YES];
</pre>
</div>
<p>
To get the size of our table we can use the <tt>count</tt> method or the convenience method 
    <tt>isEmpty</tt>:
</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">size_t cnt = [people count];                               // cnt = 6
BOOL empty = [people isEmpty];     			   // empty = NO
</pre>
</div>
<h2>Working with individual rows</h2>
<p>
To access the individual rows of our table, we use the <tt>objectAtIndex</tt> method which returns a cursor to the row index.
</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp=""> // Getting values directly
 const char* name = [table objectAtIndex:5].Name;   // =&gt; 'Anni'
 // Using a cursor 
 PeopleTable_Cursor myRow = [table objectAtIndex:5];
 int64_t age = myRow.Age;                           // =&gt; 54
 BOOL hired  = myRow.Hired;                         // =&gt; true

 // Setting values
 [[table objectAtIndex:5] setAge:43];               // Getting younger
 // or with dot-syntax:
 myRow.Age += 1;                                    // Happy birthday!
</pre>
</div>
<p>
    To get the last row, the <tt>lastObject</tt> method can be used:
</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp=""> const char* name = [people lastObject].Name;       // =&gt; "Anni"
</pre>
</div>
<p>
Replacing an entire row will be supported in the very near future:
</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp=""> [people setAtIndex:4 Name:"Eric&quot; Age:50 Hired:YES];
</pre>
</div>
<p>
    Deleting a specific row can be done with the <tt>deleteRow</tt> method, and deleting all rows with the 
    <tt>clear</tt> method.</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">[people deleteRow:2];                                          
size_t cnt = [people count];                        // cnt = 5
</pre>
</div>
<p>
    Iterating over the rows can be done as follows:
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">for (size_t i = 0; i &lt; [people count]; ++i) {
    PeopleTable_Cursor row = [people objectAtIndex:i];
    NSLog(@&quot;%s is %lld years old&quot;, row.Name, row.Age);
}
</pre>
</div>
<p>
Which will output the following:


<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre>John is 20 years old.
Mary is 21 years old.
Lars is 21 years old.
Eric is 50 years old.
Anni is 44 years old.
</pre>
</div>
<h2>Simple Searching</h2>
<p>
To find values in a specific column, we use the <tt>find</tt> method:
</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">size_t row; 
row = [people.Name find:@"Philip"];		    // (size_t)-1. Not found
row = [people.Name find:@"Mary"];		    // row = 1
</pre>
</div>
<p>To find all values, the <tt>findAll</tt> method is used:</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">TableView *view = [people.Age findAll:21];   
size_t cnt = [view count];  			// cnt = 2</pre>
</div>
    <p>&nbsp;</p>
    <h2>Queries</h2>
<p>
Sometimes you may need to do more advanced queries on tables. You can do this using the 
    <tt>getQuery</tt> method, which returns a new query object with properties for each column in the table (in this case 
    <tt>Name</tt>, <tt>Age</tt> and <tt>Hired</tt>).
 Each property is an object with methods for comparisons depending on 
type. All comparison methods return the query object itself, so they can
 be chained. You can perform operations with the query itself, or use <tt>findAll</tt> to get a virtual table with all matching rows.
 </p><p>
So let's say you need to find all current employees who are between 20 and 30 years old:

<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">// Create query (current employees between 20 and 30 years old)
Query *q = [[[people getQuery].Hired equal:YES]            // Implicit AND
                              .Age between:20 to:30];

// Get number of matching entries
size_t cnt = [q count];                                   // =&gt; 2

// Get the average age (currently only a low-level interface)
double avg = [q.Age avg];

// Execute the query and return a table (view)
TableView *res = [q findAll];
for (size_t i = 0; i < [res count]; ++i) {
    NSLog(@"%zu: %@ is %d years old", i, 
        [people objectAtIndex:i].Name, 
        [people objectAtIndex:i].Age);
}
</pre>
</div>
<p>
Note that the result is a live virtual view, that allow you to directly access and modify the values in the original table.
</p>
<p>
You can do much more advanced queries with parenthesis and or operators etc. 
Please see the reference manual.</p>
<h2>Serialization</h2>
<p>
You can group tables and do very fast serialization to and from files and memory buffers.
</p>
<div class="code" style="width: 600px; margin: 0px auto -1px; padding: 10px;">
<pre class="prettyprint" lang-cpp="">TDB_TABLE_3(PeopleTable,
 	    String, Name,
 	    Int,    Age,
	    Bool,   Hired)
 
// Create Table in Group
Group *group = [Group group];
PeopleTable *table = [group getTable:@"employees"
                            withClass:[PeopleTable class]];
 
// Add some rows
[people addName:@"John&quot; Age:20 Hired:YES];
[people addName:@"Mary&quot; Age:21 Hired:NO];
[people addName:@"Lars&quot; Age:21 Hired:YES];
[people addName:@"Phil&quot; Age:43 Hired:NO];
[people addName:@"Anni&quot; Age:54 Hired:YES];
	
// Write to disk
[group write:@"employees.tightdb"];
	
// Load a group from disk (and print contents)
Group *fromDisk = [Group groupWithFilename:@"employees.tightdb"];
PeopleTable *diskTable = [fromDisk getTable:@"employees" 
				    withClass:[PeopleTable class]];
NSLog(@"Disktable size: %zu", [diskTable count]);
for (size_t i = 0; i < [diskTable count]; i++) {
   MyTable_Cursor *cursor = [diskTable objectAtIndex:i];
   NSLog(@"%zu: %@", i, [cursor Name]);             // using std. method
}

// Write same group to memory buffer
size_t len;
const char* const buffer = [group writeToMem:&amp;len];

// Load a group from memory (and print contents)
Group *fromMem = [Group groupWithBuffer: buffer len:len];
PeopleTable *memTable = [fromMem getTable:@"employees" 
 			          withClass:[PeopleTable class]];
for (size_t i = 0; i < [memTable count]; i++) {
    PeopleTable_Cursor *cursor = [memTable objectAtIndex:i];
    NSLog(@"%zu: %@", i, cursor.Name);              // using dot-syntax
}
</pre>
</div>
<p>
Hope this quick mini tutorial will get you started with TightDB :)
</p>

<h2>Copyright</h2>
<p>
Copyright (c) 2012 TightDB, Inc.
</p>
</div>


</body></html>
